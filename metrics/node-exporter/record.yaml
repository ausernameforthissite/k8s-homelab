---
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: record-node-cpu
  labels:
    prometheus.io/instance: main
    instance.prometheus.io/main: enable
    instance.prometheus.io/prompp: enable
spec:
  groups:
  - name: record-node-cpu
    rules:
    - record: node:cpu_cores
      expr: |-
        count without(cpu) (count without(mode) (node_cpu_seconds_total))
    - record: instance_mode:node_cpu_seconds:irate
      expr: |-
        sum without(cpu) (irate(node_cpu_seconds_total[30s]))
