---
apiVersion: monitoring.coreos.com/v1alpha1
kind: ScrapeConfig
metadata:
  name: external-etcd
  namespace: prometheus
  labels:
    prometheus.io/instance: main
    instance.prometheus.io/main: enable
    instance.prometheus.io/prompp: enable
spec:
  scheme: HTTPS
  tlsConfig:
    insecureSkipVerify: false
    ca:
      secret:
        name: external-etcd-client-cert
        key: ca.crt
    cert:
      secret:
        name: external-etcd-client-cert
        key: client.crt
    keySecret:
      name: external-etcd-client-cert
      key: client.key
  relabelings:
  - targetLabel: instance
    sourceLabels: [ __address__ ]
    regex: (.*):\d*
    action: replace
  metricRelabelings:
  - action: drop
    sourceLabels: [ __name__ ]
    regex: etcd_debugging_.*|etcd_mvcc_hash_.*|etcd_server_apply_.*|etcd_server_range_.*
  - action: drop
    sourceLabels: [ __name__ ]
    # peer rtt metric is useless
    # https://github.com/etcd-io/etcd/issues/17837
    regex: etcd_network_peer_round_trip_time_.*
  - action: drop
    sourceLabels: [ __name__ ]
    regex: go_.*|promhttp_.*|grpc_.*
