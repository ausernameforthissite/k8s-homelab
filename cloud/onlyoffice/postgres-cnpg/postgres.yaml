---
apiVersion: postgresql.cnpg.io/v1
kind: Cluster
metadata:
  name: postgres
spec:
  instances: 2
  primaryUpdateStrategy: unsupervised
  postgresql:
    # parameters:
    #   shared_buffers: 256MB
    #   pg_stat_statements.max: '10000'
    #   pg_stat_statements.track: all
    #   auto_explain.log_min_duration: '10s'
    pg_hba:
    - local   all             all                             trust
    - host    all             all          127.0.0.1/32       md5
    - host    all             all          ::1/128            md5
    - hostssl all             all          all                md5
    - host    all             all          all                md5
  storage:
    size: 1Gi
    storageClass: AUTOREPLACE_STORAGE_CLASS
  managed:
    services:
      disabledDefaultServices: ["ro", "r"]
  affinity:
    enablePodAntiAffinity: true
    podAntiAffinityType: required
    topologyKey: kubernetes.io/hostname
