---
apiVersion: gateway.networking.k8s.io/v1
kind: Gateway
metadata:
  name: main-private
  namespace: gateways
spec:
  gatewayClassName: cilium
  listeners:
  - name: http
    protocol: HTTP
    port: 80
    allowedRoutes:
      namespaces:
        from: Same
  - name: https-main
    protocol: HTTPS
    port: 443
    allowedRoutes:
      namespaces:
        from: All
    tls:
      mode: Terminate
      certificateRefs:
      - kind: Secret
        namespace: cm-manual
        name: main-wildcard
  - name: tls-main
    protocol: TLS
    port: 443
    allowedRoutes:
      namespaces:
        from: All
    tls:
      mode: Terminate
      certificateRefs:
      - kind: Secret
        namespace: cm-manual
        name: main-wildcard
---
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: http-redirect-private
  namespace: gateways
spec:
  parentRefs:
  - kind: Gateway
    namespace: gateways
    name: main-private
    sectionName: http
  rules:
  - filters:
    - type: RequestRedirect
      requestRedirect:
        scheme: https
        statusCode: 301
